<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Present Tense Practice</title>

<style>
  body {
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #6dd5fa, #2980b9);
    color: #fff;
    max-width: 650px;
    margin: 0 auto;
    padding: 30px;
    text-align: center;
  }

  /* CAPIBARA GRANDE */
  #bigCapybara {
    font-size: 6rem;
    animation: sway 3s infinite ease-in-out;
    margin-bottom: 10px;
  }
  @keyframes sway {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(3deg); }
    50% { transform: rotate(0deg); }
    75% { transform: rotate(-3deg); }
    100% { transform: rotate(0deg); }
  }

  /* ANIMACIONES */
  .fadeIn { animation: fadeIn 0.6s ease; }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .pop { animation: pop 0.3s ease; }
  @keyframes pop {
    0% { transform: scale(0.8); }
    100% { transform: scale(1); }
  }

  .bounce {
    animation: bounce 1s infinite ease-in-out;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  #capybara {
    font-size: 4rem;
    display: none;
    margin-top: 10px;
  }

  #card {
    background: #fff;
    color: #222;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.25);
    font-size: 1.6rem;
    font-weight: 600;
    margin-bottom: 25px;
  }

  button {
    padding: 12px 20px;
    margin: 10px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: transform 0.15s;
  }
  button:hover { transform: scale(1.05); }

  .optionBtn { background: #ffdd57; color: #222; }
  .chosen { background: #4caf50 !important; color: #fff !important; }

  #goOn { 
    background: #4caf50; 
    color: #fff; 
    display: none; 
  }

  #feedback {
    font-size: 1.2rem;
    margin-top: 15px;
    font-weight: bold;
    min-height: 40px;
  }

  #orderBox {
    background: rgba(255,255,255,0.2);
    padding: 10px;
    border-radius: 10px;
    min-height: 40px;
    margin-bottom: 15px;
    font-size: 1.2rem;
  }
</style>
</head>
<body>

<!-- CAPIBARA GRANDE -->
<div id="bigCapybara">üêπüíñ</div>

<!-- AUDIO -->
<audio id="bgMusic" src="audio/kahoot.mp3" loop></audio>

<!-- PANTALLA DE NOMBRE -->
<div id="nameScreen" class="fadeIn">
  <h2>Welcome!</h2>
  <p>Write your name:</p>
  <input id="studentNameInput" type="text" placeholder="Your name" style="padding:10px; font-size:1rem; border-radius:8px; border:none;">
  <br><br>
  <button onclick="startGame()" style="background:#4caf50; color:#fff;">START</button>
</div>

<!-- JUEGO -->
<div id="gameScreen" style="display:none;">

<h1 class="fadeIn">Present Tense Practice</h1>

<div id="score">Score: 0</div>
<div id="timer">Time: 0s</div>

<div id="card" class="fadeIn"></div>

<div id="orderBox"></div>

<div id="options"></div>

<div id="feedback"></div>

<div id="capybara" class="bounce">üêπ‚ú®</div>

<button id="goOn" onclick="nextQuestion()">GO ON</button>

</div>

<script>
/* ---------------- SENTENCES ---------------- */
const simpleSentences = [
  "She usually gets up early.",
  "I never drink tea in the morning.",
  "He often plays basketball after school.",
  "We always walk to class.",
  "Do you like chocolate?",
  "Does she play the piano?",
  "Do they live in this neighborhood?"
];

const continuousSentences = [
  "She is studying English right now.",
  "They are doing their homework at the moment.",
  "Are you studying right now?",
  "Is she doing her homework?"
];

const funCorrect = ["Great job!", "Nice!", "Perfect!", "Amazing!", "Well done!"];
const funIncorrect = ["Try again!", "Not yet!", "Check it!", "Almost!"];

let current = {};
let score = 0;
let timer = 0;
let timerInterval;
let studentName = "";

/* ---------------- START GAME ---------------- */
function startGame() {
  document.getElementById("bgMusic").play();

  const input = document.getElementById("studentNameInput").value.trim();
  if (input === "") { alert("Enter your name"); return; }

  studentName = input;

  document.getElementById("nameScreen").style.display = "none";
  document.getElementById("gameScreen").style.display = "block";

  nextQuestion();
}

/* ---------------- TIMER ---------------- */
function startTimer() {
  timer = 0;
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    timer++;
    document.getElementById("timer").textContent = "Time: " + timer + "s";
  }, 1000);
}

/* ---------------- RANDOM QUESTION ---------------- */
function nextQuestion() {
  document.getElementById("feedback").textContent = "";
  document.getElementById("goOn").style.display = "none";
  document.getElementById("orderBox").textContent = "";
  document.getElementById("capybara").style.display = "none";

  const type = Math.random() < 0.5 ? "simple" : "continuous";
  const list = type === "simple" ? simpleSentences : continuousSentences;

  current = {
    text: list[Math.floor(Math.random() * list.length)],
    correct: type === "simple" ? "Present Simple" : "Present Continuous",
    mode: Math.random() < 0.5 ? "multiple" : "order"
  };

  renderQuestion();
}

/* ---------------- SHUFFLE REAL ---------------- */
function shuffleArray(array) {
  let a = [...array];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* ---------------- RENDER QUESTION ---------------- */
function renderQuestion() {
  startTimer();
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";

  if (current.mode === "multiple") {
    document.getElementById("card").textContent = current.text;

    ["Present Simple", "Present Continuous"].forEach(opt => {
      const btn = document.createElement("button");
      btn.textContent = opt;
      btn.className = "optionBtn fadeIn";
      btn.onclick = () => checkAnswer(opt);
      optionsDiv.appendChild(btn);
    });

  } else {
    document.getElementById("card").textContent = "Order the sentence:";

    const words = current.text.replace(/[?.,!]/g, "").split(" ");
    let shuffled;

    do { shuffled = shuffleArray(words); }
    while (shuffled.join(" ") === words.join(" "));

    current.typed = [];

    shuffled.forEach(w => {
      const btn = document.createElement("button");
      btn.textContent = w;
      btn.className = "optionBtn fadeIn";
      btn.onclick = () => pickWord(w, btn);
      optionsDiv.appendChild(btn);
    });
  }
}

/* ---------------- MULTIPLE CHOICE ---------------- */
function checkAnswer(choice) {
  if (choice === current.correct) {
    score++;
    document.getElementById("score").textContent = "Score: " + score;

    document.getElementById("feedback").textContent =
      funCorrect[Math.floor(Math.random() * funCorrect.length)];
    document.getElementById("feedback").classList.add("pop");

    document.getElementById("capybara").style.display = "block";

    clearInterval(timerInterval);
    document.querySelectorAll(".optionBtn").forEach(b => b.disabled = true);

    document.getElementById("goOn").style.display = "inline-block";
  } else {
    document.getElementById("feedback").textContent =
      funIncorrect[Math.floor(Math.random() * funIncorrect.length)];
  }
}

/* ---------------- ORDERING (FIXED) ---------------- */
function pickWord(word, btn) {
  btn.classList.add("chosen");
  btn.disabled = true;

  current.typed.push(word);
  document.getElementById("orderBox").textContent = current.typed.join(" ");

  const normalize = s =>
    s.replace(/[?.,!]/g, "").trim().toLowerCase();

  const typed = normalize(current.typed.join(" "));
  const correct = normalize(current.text);

  // ‚úîÔ∏è Caso 1: frase correcta
  if (typed === correct) {
    score++;
    document.getElementById("score").textContent = "Score: " + score;

    document.getElementById("feedback").textContent =
      funCorrect[Math.floor(Math.random() * funCorrect.length)];
    document.getElementById("capybara").style.display = "block";

    clearInterval(timerInterval);
    document.querySelectorAll(".optionBtn").forEach(b => b.disabled = true);

    document.getElementById("goOn").style.display = "inline-block";
    return;
  }

  // ‚úîÔ∏è Caso 2: us√≥ TODAS las palabras pero NO coincide ‚Üí error real
  if (current.typed.length === current.text.replace(/[?.,!]/g, "").split(" ").length) {
    document.getElementById("feedback").textContent = "Incorrect!";
    document.getElementById("card").textContent = "Correct sentence: " + current.text;

    clearInterval(timerInterval);
    document.querySelectorAll(".optionBtn").forEach(b => b.disabled = true);

    document.getElementById("goOn").style.display = "inline-block";
    return;
  }

  // ‚úîÔ∏è Caso 3: todav√≠a no ha terminado ‚Üí seguir
  document.getElementById("feedback").textContent = "Keep going!";
}
</script>

</body>
</html>
